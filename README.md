# üöÄ SmartWallet Backend API

Backend –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è SmartWallet - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã —Å –ª—É—á—à–∏–º –∫—ç—à–±—ç–∫–æ–º –¥–ª—è –æ–ø–ª–∞—Ç—ã.

## ‚ö° –ë–´–°–¢–†–´–ô –ó–ê–ü–£–°–ö (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

1. **–°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ö–∏–≤** `SmartWallet_API.zip`
2. **–†–∞—Å–ø–∞–∫—É–π—Ç–µ** –≤ –ª—é–±—É—é –ø–∞–ø–∫—É
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ** `–ó–ê–ü–£–°–ö.bat`
4. **–ì–æ—Ç–æ–≤–æ!** API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:8000

üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**: `–ò–ù–°–¢–†–£–ö–¶–ò–Ø.txt`

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è API
- **SQLite** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
- **SQLAlchemy** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **JWT** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Pydantic** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**SQLite –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏!** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

–§–∞–π–ª `.env` –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏:
```env
DATABASE_URL=sqlite:///./smartwallet.db
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ `–ó–ê–ü–£–°–ö.bat`
2. –í—Å—ë –Ω–∞—Å—Ç—Ä–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ PyCharm
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `run_server.py`
2. –ù–∞–∂–º–∏—Ç–µ **Ctrl+Shift+F10** (Run 'run_server')

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
```bash
python init_db.py  # –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python run_server.py  # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```

#### –í–∞—Ä–∏–∞–Ω—Ç 4: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–æ—Å–æ–±
```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### 4. –î–æ—Å—Ç—É–ø –∫ API

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- **–õ–æ–∫–∞–ª—å–Ω–æ**: http://localhost:8000
- **–í —Å–µ—Ç–∏**: http://[–í–ê–®_IP]:8000 (IP –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Å–æ–ª–∏)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://[–í–ê–®_IP]:8000/docs

### 5. –î–æ—Å—Ç—É–ø —Å –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

1. **–£–∑–Ω–∞–π—Ç–µ IP –∞–¥—Ä–µ—Å** –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (–ø–æ–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ)
2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 8000 –æ—Ç–∫—Ä—ã—Ç** –≤ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–µ Windows
3. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** –ø–æ –∞–¥—Ä–µ—Å—É: `http://[IP]:8000`

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞ Windows:
1. –û—Ç–∫—Ä–æ–π—Ç–µ **–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** ‚Üí **–°–∏—Å—Ç–µ–º–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Üí **–ë—Ä–∞–Ω–¥–º–∞—É—ç—Ä Windows**
2. –ù–∞–∂–º–∏—Ç–µ **"–†–∞–∑—Ä–µ—à–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º"**
3. –ù–∞–π–¥–∏—Ç–µ **Python** –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–ª—è **—á–∞—Å—Ç–Ω–æ–π –∏ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π —Å–µ—Ç–∏**
4. –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø–æ—Ä—Ç–∞ **8000**

## API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /auth/login` - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `GET /auth/profile` - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ö–∞—Ä—Ç—ã
- `GET /cards` - –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /cards` - –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É
- `GET /cards/{id}` - –î–µ—Ç–∞–ª–∏ –∫–∞—Ä—Ç—ã

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `GET /transactions` - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `POST /transactions` - –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é

### –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
- `GET /assistant/recommendations` - –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- `POST /assistant/chat` - –ß–∞—Ç —Å AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º

### –ö—ç—à–±—ç–∫
- `GET /cashback/best-card?category=–µ–¥–∞` - –ù–∞–π—Ç–∏ –ª—É—á—à—É—é –∫–∞—Ä—Ç—É –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ users
- `id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `phone` - –¢–µ–ª–µ—Ñ–æ–Ω
- `email` - Email
- `name` - –ò–º—è
- `password_hash` - –•—ç—à –ø–∞—Ä–æ–ª—è
- `created_at` - –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### –¢–∞–±–ª–∏—Ü–∞ cards
- `id` - ID –∫–∞—Ä—Ç—ã
- `user_id` - –í–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ä—Ç—ã
- `bank_name` - –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞
- `card_name` - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
- `last4` - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã
- `cashback_rules` - –ü—Ä–∞–≤–∏–ª–∞ –∫—ç—à–±—ç–∫–∞ (JSON)
- `limit_monthly` - –ú–µ—Å—è—á–Ω—ã–π –ª–∏–º–∏—Ç –∫—ç—à–±—ç–∫–∞
- `created_at` - –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

### –¢–∞–±–ª–∏—Ü–∞ transactions
- `id` - ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `user_id` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `card_id` - –ö–∞—Ä—Ç–∞
- `amount` - –°—É–º–º–∞
- `category` - –ö–∞—Ç–µ–≥–æ—Ä–∏—è
- `cashback_earned` - –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫—ç—à–±—ç–∫
- `created_at` - –î–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –¢–∞–±–ª–∏—Ü–∞ recommendations
- `id` - ID —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- `user_id` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `message` - –¢–µ–∫—Å—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- `type` - –¢–∏–ø ("—Å–æ–≤–µ—Ç" / "–∞–∫—Ü–∏—è")
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl -X POST "http://localhost:8000/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "+79001234567",
    "email": "user@example.com",
    "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "password": "password123"
  }'
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
```bash
curl -X POST "http://localhost:8000/cards" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "bank_name": "–°–±–µ—Ä–±–∞–Ω–∫",
    "card_name": "–°–±–µ—Ä–±–∞–Ω–∫ –ü—Ä–µ–º—å–µ—Ä",
    "last4": "1234",
    "cashback_rules": {"–µ–¥–∞": 5, "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç": 3, "–ø—Ä–æ—á–µ–µ": 1},
    "limit_monthly": 5000.00
  }'
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```bash
curl -X POST "http://localhost:8000/transactions" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "card_id": 1,
    "amount": 1000.00,
    "category": "–µ–¥–∞"
  }'
```

### –ü–æ–∏—Å–∫ –ª—É—á—à–µ–π –∫–∞—Ä—Ç—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```bash
curl -X GET "http://localhost:8000/cashback/best-card?category=–µ–¥–∞" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### –ß–∞—Ç —Å AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º
```bash
curl -X POST "http://localhost:8000/assistant/chat" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"message": "–ü—Ä–∏–≤–µ—Ç, –ø–æ–¥—Å–∫–∞–∂–∏ –ª—É—á—à–∏–π –∫—ç—à–±—ç–∫ –Ω–∞ –µ–¥—É?"}'
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
‚îú‚îÄ‚îÄ main.py                 # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ database.py            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ models.py              # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ schemas.py             # Pydantic —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ auth.py                # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ routers/               # API —Ä–æ—É—Ç–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ auth.py           # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ cards.py          # –ö–∞—Ä—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ transactions.py   # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ assistant.py      # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ cashback.py       # –ö—ç—à–±—ç–∫
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ test_chat.py          # –¢–µ—Å—Ç —á–∞—Ç–∞ —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º
‚îú‚îÄ‚îÄ test_recommendations.py # –¢–µ—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
‚îú‚îÄ‚îÄ chat_client.py        # –ö–ª–∏–µ–Ω—Ç –¥–ª—è —á–∞—Ç–∞
‚îî‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –≤ —Ñ–∞–π–ª–µ `smartwallet.db`.

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
```bash
python init_db.py
```

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
- –¢–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∏–º–µ—Ä—ã –∫–∞—Ä—Ç —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∫—ç—à–±—ç–∫–∞
- –¢–µ—Å—Ç–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

#### –¢–µ—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:
```bash
python test_recommendations.py
```

#### –¢–µ—Å—Ç —á–∞—Ç–∞ —Å AI:
```bash
python test_chat.py
```

#### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç:
```bash
python chat_client.py
```

–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- **–¢–µ–ª–µ—Ñ–æ–Ω**: +79001234567
- **–ü–∞—Ä–æ–ª—å**: password123
